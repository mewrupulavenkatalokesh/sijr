<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Homemade Products â€” Shop</title>
<style>
  :root{--green:#2e7d32;--accent:#4CAF50;--muted:#666;--card-bg:#fff;}
  body{margin:0;font-family:system-ui,sans-serif;background:#f7f7f7;color:#222;}
  header{background:var(--green);color:#fff;padding:1rem;text-align:center;}
  .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;padding:1rem;}
  .card{background:var(--card-bg);padding:1rem;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);position:relative;}
  .card img{width:100%;border-radius:12px;}
  .badge{position:absolute;top:10px;left:10px;background:#ff9800;color:#fff;padding:2px 8px;border-radius:8px;font-size:.8rem;}
  .cart-btn{position:fixed;top:1rem;right:1rem;background:var(--accent);color:#fff;padding:.5rem 1rem;border:none;border-radius:20px;cursor:pointer;}
  #cart{position:fixed;right:-400px;top:0;width:350px;height:100%;background:#fff;box-shadow:-2px 0 8px rgba(0,0,0,.2);transition:.3s;padding:1rem;overflow-y:auto;}
  #cart.open{right:0;}
  .item{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;}
  .item img{width:50px;height:50px;border-radius:8px;}
  .qty{width:50px;}
  #toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:.5rem 1rem;border-radius:20px;display:none;}
  #checkoutArea{background:#fff;padding:1rem;margin:1rem;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1);}
  #checkoutArea input{width:100%;padding:.5rem;margin:.3rem 0;border:1px solid #ccc;border-radius:8px;}
  #qrWrap{text-align:center;margin-top:1rem;display:none;}
  #qrWrap img{max-width:200px;border:4px solid #eee;border-radius:12px;}
</style>
</head>
<body>
<header>
  <h2>Homemade Products</h2>
  <button class="cart-btn" onclick="toggleCart()">ðŸ›’ Cart (<span id="cartCount">0</span>)</button>
</header>

<div id="products" class="products"></div>

<div id="cart">
  <h3>Your Cart</h3>
  <div id="cartList"></div>
  <p><strong>Total: â‚¹<span id="totalPrice">0</span></strong></p>
  <button id="proceedBtn" onclick="proceedToCheckout()">Proceed to Checkout</button>
</div>

<div id="checkoutArea" style="display:none;">
  <h3>Checkout</h3>
  <div><strong>Items:</strong> <span id="checkoutItemsSummary"></span></div>
  <div><strong>Total:</strong> â‚¹<span id="checkoutTotal"></span></div>
  <input id="c_name" placeholder="Full Name" required>
  <input id="c_phone" placeholder="Phone Number (10 digits)" required>
  <input id="c_email" placeholder="Email" required>
  <input id="c_street" placeholder="Street Details" required>
  <input id="c_landmark" placeholder="Landmark" required>
  <input id="c_village" placeholder="Village" required>
  <input id="c_pincode" placeholder="Pincode" required>
  <input id="c_mandal" placeholder="Mandal" required>
  <input id="c_district" placeholder="District" required>
  <input id="c_state" placeholder="State" required>
  <div style="margin-top:1rem;">
    <button onclick="confirmOrder('Cash on Delivery')">Cash on Delivery</button>
    <button onclick="confirmOrder('Online')">Pay Online</button>
  </div>
  <div id="qrWrap">
    <p>ðŸ“² Scan & Pay using UPI</p>
    <img src="upi-qr.jpg" alt="UPI QR">
    <!-- confirm button will be added dynamically -->
  </div>
</div>

<div id="toast"></div>

<script>
const products=[
  {id:'pippalu',name:'Pippalu',img:'pippalu.jpg',desc:'Delicious homemade Pippalu with authentic taste.',priceOptions:{'100g':50,'200g':90,'500g':200},badge:'Best Seller'},
  {id:'murukulu',name:'Murukulu',img:'murukulu.jpg',desc:'Crispy homemade Murukulu made with love.',priceOptions:{'100g':60,'200g':110,'500g':250},badge:'New'}
];
let cart=[];
function $(s){return document.querySelector(s)}
function showToast(msg,t=2000){const e=$('#toast');e.textContent=msg;e.style.display='block';clearTimeout(e._hide);e._hide=setTimeout(()=>e.style.display='none',t)}
function renderProducts(){const c=$('#products');c.innerHTML='';products.forEach(p=>{const card=document.createElement('div');card.className='card';card.innerHTML=`${p.badge?`<div class="badge">${p.badge}</div>`:''}<img src="${p.img}"><h4>${p.name}</h4><p>${p.desc}</p><label>Select quantity & price</label><select id="select-${p.id}"><option value="">Select Quantity</option>${Object.entries(p.priceOptions).map(([k,v])=>`<option value="${k} - ${v}">${k} - â‚¹${v}</option>`).join('')}</select><button class="add" onclick="addToCart('${p.id}')">Add to Cart</button>`;c.appendChild(card)})}
function addToCart(id){const s=$(`#select-${id}`);if(!s.value){showToast('Please select quantity first');return}const[l,p]=s.value.split(' - ');const price=parseInt(p);const pr=products.find(x=>x.id===id);const ex=cart.find(i=>i.id===id&&i.optionLabel===l);if(ex){ex.qty++}else{cart.push({id:pr.id,name:pr.name,optionLabel:l,price:price,qty:1,img:pr.img})}updateCartUI();showToast(`${pr.name} added`)}
function updateCartUI(){const l=$('#cartList');l.innerHTML='';let t=0;cart.forEach((it,i)=>{t+=it.price*it.qty;const d=document.createElement('div');d.className='item';d.innerHTML=`<img src="${it.img}"><div class="info"><strong>${it.name}</strong><small>${it.optionLabel} â€¢ â‚¹${it.price}</small></div><div><input class="qty" type="number" value="${it.qty}" min="1" onchange="updateQty(${i},this.value)"><div><button onclick="removeItem(${i})">Remove</button></div></div>`;l.appendChild(d)});$('#totalPrice').textContent=t;$('#cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0);$('#proceedBtn').disabled=cart.length===0}
function updateQty(i,v){cart[i].qty=parseInt(v)||1;updateCartUI()}
function removeItem(i){cart.splice(i,1);updateCartUI()}
function toggleCart(){$('#cart').classList.toggle('open')}
function proceedToCheckout(){if(cart.length===0){showToast('Cart empty');return}toggleCart();$('#checkoutItemsSummary').textContent=cart.map(it=>`${it.name} (${it.optionLabel}) x ${it.qty}`).join(', ');$('#checkoutTotal').textContent=cart.reduce((s,i)=>s+i.price*i.qty,0);$('#checkoutArea').style.display='block';window.scrollTo({top:$('#checkoutArea').offsetTop-20,behavior:'smooth'})}

function confirmOrder(type){
  const name=$('#c_name').value.trim(),
        phone=$('#c_phone').value.trim(),
        email=$('#c_email').value.trim(),
        street=$('#c_street').value.trim(),
        landmark=$('#c_landmark').value.trim(),
        village=$('#c_village').value.trim(),
        pin=$('#c_pincode').value.trim(),
        mandal=$('#c_mandal').value.trim(),
        dist=$('#c_district').value.trim(),
        state=$('#c_state').value.trim();

  if(!name||!phone||!email||!street||!landmark||!village||!pin||!mandal||!dist||!state){showToast('âš ï¸ Please fill all fields');return;}
  if(!/^\d{10}$/.test(phone)){showToast('âš ï¸ Enter valid 10 digit phone');return;}
  if(!/^\S+@\S+\.\S+$/.test(email)){showToast('âš ï¸ Enter valid email');return;}
  if(!/^\d{6}$/.test(pin)){showToast('âš ï¸ Enter valid 6 digit pincode');return;}

  const orderItems=cart.map(i=>`${i.name} (${i.optionLabel}) x ${i.qty} = â‚¹${i.price*i.qty}`).join("\n");
  const total=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const addr=`${street}, ${landmark}, ${village}, ${mandal}, ${dist}, ${state}, ${pin}`;

  if(type==='Cash on Delivery'){
    sendOrder({name,phone,email,addr,orderItems,total,type});
  }

  if(type==='Online'){
    $('#qrWrap').style.display='block';
    if(!$('#confirmPayBtn')){
      const btn=document.createElement('button');
      btn.id='confirmPayBtn';
      btn.textContent='âœ… I Have Paid, Place Order';
      btn.style.cssText="margin-top:12px;padding:10px;border:none;border-radius:8px;background:#4caf50;color:#fff;cursor:pointer;width:100%";
      btn.onclick=()=>sendOrder({name,phone,email,addr,orderItems,total,type});
      $('#qrWrap').appendChild(btn);
    }
    showToast('ðŸ“² Please scan and pay, then confirm');
  }
}

function sendOrder({name,phone,email,addr,orderItems,total,type}){
  const fd=new FormData();
  fd.append("name",name);
  fd.append("phone",phone);
  fd.append("email",email);
  fd.append("address",addr);
  fd.append("order_items",orderItems);
  fd.append("order_total","â‚¹"+total);
  fd.append("payment_method",type);

  fetch("https://formspree.io/f/xvgbdqpz",{method:"POST",body:fd,headers:{'Accept':'application/json'}})
  .then(r=>{
    if(r.ok){
      alert("âœ… Order placed! We will contact you soon.");
      clearAfterOrder();
    } else {alert("âš ï¸ Failed to send order. Try again later.");}
  }).catch(()=>alert("âš ï¸ Network error while sending order"));
}

function clearAfterOrder(){cart=[];updateCartUI();$('#checkoutArea').style.display='none';$('#qrWrap').style.display='none';document.querySelectorAll('#checkoutArea input').forEach(i=>i.value='')}
renderProducts();updateCartUI();
</script>
</body>
</html>
